<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Findr | YESA</title>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <!-- Litepicker CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" />

  <!-- AOS for animations -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .glass {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
    .table-wrapper {
      overflow-x: auto;
      margin-bottom: 20px;
    }
    .excel-style th, .excel-style td {
      white-space: pre;
    }
    table.excel-style {
      width: 100%;
      border-collapse: collapse;
      font-family: monospace;
      font-size: 14px;
      margin-bottom: 30px;
      background-color: #fff;
      color: #000;
    }
    table.excel-style th, table.excel-style td {
      border: 1px solid #000;
      padding: 6px 10px;
      white-space: pre;
    }
    table.excel-style th {
      background-color: #e5e5e5;
      font-weight: bold;
    }
    .copy-btn {
      background: #4f46e5;
      color: white;
      padding: 6px 12px;
      margin-left: 10px;
      font-size: 12px;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body class="bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 text-white min-h-screen">
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-4xl font-extrabold text-white mb-6 text-center" data-aos="fade-down">üîé Findr ‚Äì YESA Discrepancy Tool</h1>

    <form method="POST" enctype="multipart/form-data" class="space-y-6 glass p-6" onsubmit="document.getElementById('spinner').classList.remove('hidden');">
      <div>
        <label class="block text-sm text-white font-semibold">üì§ Upload Booked Sales CSV:</label>
        <input type="file" name="csv_file" required class="mt-1 w-full bg-gray-700 text-white p-2 rounded border border-gray-600">
      </div>

      <div>
        <label class="block text-sm text-white font-semibold">üìÖ Booked Date Range:</label>
        <input type="text" id="date-range" name="date_range" required placeholder="Select date range" class="mt-1 w-full bg-gray-700 text-white p-2 rounded border border-gray-600">
      </div>

      <div>
        <label class="block text-sm text-white font-semibold">üîó Paste Google Sheet URL:</label>
        <input type="url" name="sheet_url" required class="mt-1 w-full bg-gray-700 text-white p-2 rounded border border-gray-600">
      </div>

      <div>
        <label class="block text-sm text-white font-semibold">üßæ Name of Appealer:</label>
        <input type="text" name="appealer_name" required class="mt-1 w-full bg-gray-700 text-white p-2 rounded border border-gray-600">
      </div>

      <div class="flex items-center justify-between">
        <button type="submit" class="bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-6 rounded shadow transition-all duration-300">üöÄ Run Report</button>
        <div id="spinner" class="hidden text-sm text-gray-400">‚è≥ Running...</div>
      </div>
    </form>

    {% if stats %}
    <div class="mt-6 bg-gray-700 p-4 rounded-lg shadow" data-aos="fade-up">
      <p class="text-lg font-semibold">Accounts Checked: {{ stats.total_checked }}</p>
      <p class="text-lg">Mismatched Accounts: {{ stats.total_mismatched }} (Ontario: {{ stats.ontario }} | Quebec: {{ stats.quebec }})</p>
    </div>
    {% endif %}

    {% if ontario %}
      <h3 class="inline-block mt-10 text-xl font-bold">Ontario Open Appeals</h3>
      <button class="copy-btn" onclick="copyTableBodyOnly('ontario-table')">Copy</button>
      <div class="table-wrapper">
        <table id="ontario-table" class="excel-style">
          <thead>
            <tr>
              {% for col in ontario[0].keys() %}<th>{{ col }}</th>{% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in ontario %}<tr>{% for val in row.values() %}<td>{{ val }}</td>{% endfor %}</tr>{% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}

    {% if quebec %}
      <h3 class="inline-block mt-10 text-xl font-bold">Quebec Open Appeals</h3>
      <button class="copy-btn" onclick="copyTableBodyOnly('quebec-table')">Copy</button>
      <div class="table-wrapper">
        <table id="quebec-table" class="excel-style">
          <thead>
            <tr>
              {% for col in quebec[0].keys() %}<th>{{ col }}</th>{% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in quebec %}<tr>{% for val in row.values() %}<td>{{ val }}</td>{% endfor %}</tr>{% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>

  <!-- JS Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/bundle.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>AOS.init();</script>
  <script>
    new Litepicker({
      element: document.getElementById("date-range"),
      singleMode: false,
      numberOfMonths: 2,
      numberOfColumns: 2,
      format: "M/D/YYYY",
      autoApply: true
    });

    function copyTableBodyOnly(tableId) {
      const table = document.getElementById(tableId);
      const rows = table.querySelectorAll("tbody tr");
      let clipboard = "";
      rows.forEach(row => {
        const cells = row.querySelectorAll("td");
        const line = Array.from(cells).map(cell => cell.innerText).join("\t");
        clipboard += line + "\n";
      });
      navigator.clipboard.writeText(clipboard).then(() => {
        const button = event.target;
        const originalText = button.innerText;
        button.innerText = "Copied!";
        setTimeout(() => button.innerText = originalText, 1500);
      });
    }
  </script>
</body>
</html>
